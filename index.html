<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dicion√°rio Tupi-Portugu√™s</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background-color: #e3f2fd; }
        h1 { color: #333; }
        .container, .add-word-container { 
            background: white; padding: 20px; border-radius: 10px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); display: inline-block; margin-top: 10px; 
        }
        input { padding: 10px; width: 250px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { 
            padding: 10px; cursor: pointer; background-color: #007bff; 
            color: white; border: none; border-radius: 5px; margin-left: 5px; 
        }
        button:hover { background-color: #0056b3; }
        p { font-size: 18px; font-weight: bold; margin-top: 10px; color: #333; }
        #history { margin-top: 20px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto; }
        .history-item { 
            background: white; padding: 8px; margin: 5px 0; border-radius: 5px; 
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.1); 
        }
        .not-found { color: red; font-weight: bold; }
        .delete-btn { background-color: red; margin-top: 10px; }
        .delete-btn:hover { background-color: darkred; }
    </style>
</head>
<body>
    <h1>Dicion√°rio Tupi-Portugu√™s</h1>

    <div class="container">
        <input type="text" id="search" placeholder="Digite uma palavra em portugu√™s...">
        <button onclick="searchWord()">Pesquisar</button>
        <p id="result">Digite uma palavra para buscar.</p>
    </div>

    <h2>Hist√≥rico de Pesquisas</h2>
    <button class="delete-btn" onclick="clearHistory()">üóë Apagar Hist√≥rico</button>
    <div id="history"></div>

    <h2>Adicionar Nova Palavra</h2>
    <div class="add-word-container">
        <input type="text" id="new-word" placeholder="Palavra em portugu√™s">
        <input type="text" id="new-translation" placeholder="Tradu√ß√£o em Tupi Antigo">
        <button onclick="addNewWord()">Adicionar</button>
        <p id="add-result"></p>
    </div>

    <script>
        let dictionary = [];

        // Carrega o JSON corretamente
        function loadDictionary() {
            fetch("dictionary.json")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erro ao carregar o JSON");
                    }
                    return response.json();
                })
                .then(data => {
                    dictionary = data.Planilha1; // Acessa a lista de palavras dentro de "Planilha1"
                    console.log("Dicion√°rio carregado com sucesso!", dictionary);
                })
                .catch(error => {
                    console.error("Erro ao carregar o dicion√°rio:", error);
                    document.getElementById("result").innerText = "Erro ao carregar dicion√°rio!";
                });
        }

        function searchWord() {
            let word = document.getElementById("search").value.trim().toLowerCase();
            if (!word) return;

            let translation = "Tradu√ß√£o n√£o encontrada";
            let found = dictionary.find(entry => entry.Portugues.toLowerCase() === word);

            if (found) {
                translation = found["Tupi Antigo"];
            }

            document.getElementById("result").innerHTML = `Tradu√ß√£o: <span class="${found ? '' : 'not-found'}">${translation}</span>`;

            // Garantir que a palavra sempre entre no hist√≥rico, mesmo se n√£o for encontrada
            addToHistory(word, translation);
        }

        function addToHistory(word, translation) {
            let history = JSON.parse(localStorage.getItem("searchHistory")) || [];
            history.unshift({ word, translation }); // Adiciona a nova busca no topo

            // Limita o hist√≥rico a 10 buscas mais recentes
            if (history.length > 10) {
                history.pop();
            }

            localStorage.setItem("searchHistory", JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            let history = JSON.parse(localStorage.getItem("searchHistory")) || [];
            let historyDiv = document.getElementById("history");
            historyDiv.innerHTML = ""; // Limpa antes de re-renderizar

            history.forEach(item => {
                let entry = document.createElement("div");
                entry.className = "history-item";
                entry.innerHTML = `üîé <strong>${item.word}</strong> ‚Üí <span class="${item.translation === 'Tradu√ß√£o n√£o encontrada' ? 'not-found' : ''}">${item.translation}</span>`;
                historyDiv.appendChild(entry);
            });
        }

        function clearHistory() {
            localStorage.removeItem("searchHistory");
            renderHistory();
        }

        function addNewWord() {
            let newWord = document.getElementById("new-word").value.trim().toLowerCase();
            let newTranslation = document.getElementById("new-translation").value.trim().toLowerCase();

            if (!newWord || !newTranslation) {
                document.getElementById("add-result").innerText = "Por favor, preencha os dois campos!";
                return;
            }

            // Verifica se a palavra j√° existe
            let exists = dictionary.find(entry => entry.Portugues.toLowerCase() === newWord);
            if (exists) {
                document.getElementById("add-result").innerText = "Essa palavra j√° existe no dicion√°rio!";
                return;
            }

            // Adiciona ao dicion√°rio carregado
            dictionary.push({ "Portugues": newWord, "Tupi Antigo": newTranslation });

            // Salva no localStorage como se fosse o JSON (simula√ß√£o)
            localStorage.setItem("dictionaryData", JSON.stringify(dictionary));

            document.getElementById("add-result").innerText = "Palavra adicionada com sucesso!";
            document.getElementById("new-word").value = "";
            document.getElementById("new-translation").value = "";

            console.log("Nova palavra adicionada ao dicion√°rio:", dictionary);
        }

        // Carrega o hist√≥rico ao abrir a p√°gina
        renderHistory();
        loadDictionary();

        // Se j√° adicionaram palavras antes, carrega o dicion√°rio salvo no localStorage
        let savedDictionary = localStorage.getItem("dictionaryData");
        if (savedDictionary) {
            dictionary = JSON.parse(savedDictionary);
        }
    </script>
</body>
</html>
